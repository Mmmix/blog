<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<title>Document</title>
		<script src="../js/vue.js"></script>
		<script src="../js/vue-resource.min.js"></script>
		<link rel="stylesheet" type="text/css" href="../layui/css/layui.css">
		<link rel="stylesheet" type="text/css" href="../css/main.css">
		<!--加载meta IE兼容文件-->
		<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
<![endif]-->
	</head>

	<body>
		<div id="app">
			<div class="header">
				<div class="menu-btn">
					<div class="menu"></div>
				</div>
				<h1 class="logo">
      <a href="index.html">
        <span>MYBLOG</span>
        <img src="../img/logo.png">
      </a>
    </h1>
				<div class="nav">
					<a href="index.html" class="active">文章</a>
					<a href="whisper.html">微语</a>
					<a href="leacots.html">留言</a>
					<a href="album.html">相册</a>
					<a href="about.html">关于</a>
				</div>
				<ul class="layui-nav header-down-nav">
					<li class="layui-nav-item">
						<a href="index.html" class="active">文章</a>
					</li>
					<li class="layui-nav-item">
						<a href="whisper.html">微语</a>
					</li>
					<li class="layui-nav-item">
						<a href="leacots.html">留言</a>
					</li>
					<li class="layui-nav-item">
						<a href="album.html">相册</a>
					</li>
					<li class="layui-nav-item">
						<a href="about.html" class="active">关于</a>
					</li>
				</ul>
				<p class="welcome-text">
					欢迎来到<span class="name">决赛圈</span>的博客~
				</p>
			</div>

			<div class="content whisper-content leacots-content details-content">
				<div class="cont w1000">
					<div class="whisper-list">
						<div class="item-box">
							<div class="review-version">
								<div class="form-box">
									<div class="article-cont">
										<div class="title">
											<h3>{{detailData.title}}</h3>
											<p class="cont-info"><span class="data">{{detailData.createTime}}</span><span class="types">散文札记</span></p>
										</div>
										<!--<p>爷每天5点起床，去鸡行里选鸡，选的是大小均匀的老母鸡，送到家里从杀鸡放血开始，鸡血要留着，倒在有盐水的碗里，烧好开水拔了毛连鸡嘴巴鼻子里的粘液都要挤出来。鸡洗干净六只鸡放到一个锅里炖，要炖一个上午，要注意火候鸡皮不能裂。</p>
                  <img src="../img/wz_img1.jpg">
                  <p>炖好的鸡挂在架子上晾干，再一片片剁开，每只鸡剁的块数都是一样，然后把鸡肉放到提前调好的水中腌两个小时，水里面的调料也是爷爷自己去市场买来磨成粉的。锅里还有剩的鸡汤，用鸡汤煮好面叶上面漂着一层绿油油的葱花。</p>
                  <p>以前爷爷都是用扁担一头面叶一头板鸡挑到街上摊位上卖，现在爷爷年纪大了，只能用三轮车推着。摊位摆好奶奶就会慢悠悠的拎着一个保温桶和一个小红桶过来，保温桶里装的是卤鸡蛋，小红桶留着装别人吃剩的骨头喂狗。他们只有晚上出摊，收完摊已经要9点钟了，回去还要洗一天用的抹布和衣服，爷爷奶奶都非常爱干净，摊上的所有抹布纱布都是白色的每天洗的一个油点都看不到。9年前奶奶去世了，爷爷奶奶青梅竹马感情非常好，奶奶去世的时候爷爷甚至还要求过把奶奶埋在院子里。现在爷爷有时候会偷偷跟我说，你奶奶昨天回来看我了，她还给我掖被子，我知道是她，我跟她说你别挂念我，我好的很 跑题了。</p>
                  <p>昨天我给爷爷打电话，他跟我说他卖板鸡有人给他拍照，他问别人你拍我干嘛，那个人回答他说我给你照片放到网上，你生意会更好，我爷爷说你不用放网上我都不够卖的。</p>-->
										<div v-html="detailData.context"></div>
										<div class="btn-box">
											<button class="layui-btn layui-btn-primary">上一篇</button>
											<button class="layui-btn layui-btn-primary">下一篇</button>
										</div>
									</div>
									<div class="form">
										<form class="layui-form">
											<div class="layui-form-item layui-form-text">
												<label class="layui-form-label layui-icon">&#xe60c;</label><input placeholder="阁下尊姓大名" v-model="guestName" class="layui-input layui-input-inline" />
												<label class="layui-form-label layui-icon">&#xe68e;</label><input placeholder="留下您的邮箱" v-model="guestEmail" class="layui-input layui-input-inline" />
												<span class="layui-text" style="color: red;">{{errmsg}}</span>
											</div>
											<div class="layui-form-item layui-form-text">
												<div class="layui-input-block">
													<textarea name="desc" placeholder="既然来了，就说几句" v-model="guestComments" class="layui-textarea"></textarea>
												</div>
											</div>
											<div class="layui-form-item">
												<div class="layui-input-block" style="text-align: right;">
													<button class="layui-btn" type="button" @click="commentArticle">確定</button>
												</div>
											</div>
										</form>
									</div>
								</div>
								<div class="volume">
									全部评论 
									<span >{{commentData.total}}</span>
								</div>
								<div class="list-cont">

									<div class="cont" v-for="(commentItem,index) in commentData.list">
										<div class="img">
											<img src="../img/header.png" alt="">
										</div>
										<div class="text">
											<p class="tit"><span class="name">{{commentItem.guestName}}</span><span class="data">{{commentItem.createTime}}</span></p>
											<p class="ct"><span>{{commentItem.content}}</span><span class="data">#{{index}}</span></p>
										</div>
										<div class="reply" v-for="child in commentItem.childList">
											<div class="img">
												<img src="../img/header.png" alt="">
											</div>
											<div class="text">
											<p class="tit"><span class="name">{{child.guestName}}</span><span class="data">{{child.createTime}}</span></p>
											<p class="ct">{{child.content}}</p>
											</div>
										</div>
									</div>
									
									<!--<div class="cont">
										<div class="img">
											<img src="../img/header.png" alt="">
										</div>
										<div class="text">
											<p class="tit"><span class="name">吳亦凡</span><span class="data">2018/06/06</span></p>
											<p class="ct">敢问大师，师从何方？上古高人呐逐一地看完你的作品后，我的心久久 不能平静！这世间怎么可能还有如此精辟的作品？我不敢相信自己的眼睛。自从改革开放以后，我就以为再也不会有任何作品能打动我，没想到今天看到这个如此精妙绝伦的作品好厉害！</p>
										</div>
									</div>-->
								</div>
							</div>
						</div>
					</div>
					<div id="demo" style="text-align: center;"></div>
				</div>
			</div>

			<div class="footer-wrap">
				<div class="footer w1000">
					<div class="qrcode">
						<img src="../img/erweima.jpg">
					</div>
					<div class="practice-mode">
						<img src="../img/down_img.jpg">
						<div class="text">
							<h4 class="title">我的联系方式</h4>
							<p>微信<span class="WeChat">1234567890</span></p>
							<p>手机<span class="iphone">1234567890</span></p>
							<p>邮箱<span class="email">1234567890@qq.com</span></p>
						</div>
					</div>
				</div>
			</div>

		</div>

		<script type="text/javascript" src="../layui/layui.js"></script>
		<script>
			layui.use(['element', 'form'], function() {
				element = layui.element, form = layui.form;
			})
			var localhost = "http://localhost:8080";
			var app = new Vue({
				el: '#app',
				data: {
					blogId: sessionStorage.getItem("detailId"),
					detailData: [],
					commentData:[],
					guestName: "",
					guestEmail: "",
					guestComments: "",
					errmsg: "",
					message: 'Hello Vue.js!'
				},
				methods: {
					getData: function() {
						var _this = this;
						Vue.http.get(localhost + '/blog/detail', {
							params: {
								'id': _this.blogId
							}
						}).then(function(res) {
							//              console.log(res);
							_this.detailData = res.body.data;
							//              console.log(_this.listData);
						}, function() {
							console.log('请求失败处理');
						});
					},
					getCommentData:function(n){
						var _this = this;
						Vue.http.get(localhost+'/comment/selectByBlogId?id='+_this.blogId,{
							params:{
								id: _this.blogId,
								'pageSize':5,
								'pageNum':n
							}
						}).then(function(res){
							console.log(res.body.data);
							_this.commentData = res.body.data;
							if(res.body.data.pageNum==1){
								_this.loadPage();
							}
						});
					},
					commentArticle: function() {
						var _this = this;
						if(this.checkValid()) {
							Vue.http.post(localhost + '/comment/add', {
								'guestName': _this.guestName,
								'guestEmail': _this.guestEmail,
								'content': _this.guestComments,
								'parentId': 0,
								'blogId': sessionStorage.getItem("detailId")
							}, {
								emulateJSON: true
							}).then(function(res){
								_this.guestName="";
								_this.guestEmail="";
								_this.guestComments="";
								console.log(res);
								_this.getCommentData();
							});
					}
				},
				checkMail: function(mail) {
					var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
					if(filter.test(mail))
						return true;
					else
						return false;
				},
				checkValid: function() {
					if(this.guestName == "") {
						this.errmsg = "请输入你的姓名";
						return false;
					} else if(!this.checkMail(this.guestEmail)) {
						this.errmsg = "请检查你的邮箱格式";
						return false;
					} else if(this.guestComments == "") {
						this.errmsg = "评论不能为空";
						return false;
					} else {
						this.errmsg = "";
						return true;
					}
				},
				loadPage:function(){
					var _this = this;
					layui.use('laypage',function(){
						layui.laypage.render({
							elem:'demo',
							count: _this.commentData.pages*10,
							jump: function(obj, first){
						    //首次不执行
						    if(!first){
						    	_this.getCommentData(obj.curr);
						    }
					  	}
						});
					})
				}
			}
			})
			//			console.log(sessionStorage.getItem("detailId"));
			app.getData();
			app.getCommentData(1);
			
		</script>
	</body>

</html>